{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://d3js.org/d3.v4.min.js"></script>

    <script src="{% static 'Server/javascript/node_modules/jquery/dist/jquery.js' %}"></script>
    <link rel="stylesheet" href="{% static 'Server/javascript/node_modules/bootstrap/dist/css/bootstrap.min.css' %}">   
    <script src="{% static 'Server/javascript/node_modules/bootstrap/dist/js/bootstrap.min.js' %}"></script>


    <link href="{% static 'Server/css/MainTheme.css' %}" rel="stylesheet">


    <style>
      svg rect {
          fill: orange;
      }

      svg text {
           fill:black;
          font: 10px sans-serif;
          text-anchor: end;
      }
  </style>
</head>
<body>
    <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
        <a class="navbar-brand col-md-3 col-lg-2 mr-0 px-3" href="#">Home Environment Monitor</a>
        <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-toggle="collapse" data-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <ul class="navbar-nav px-3">
          <li class="nav-item text-nowrap">
            <a class="nav-link" href="/admin">Admin</a>
          </li>
        </ul>
      </nav>

      <div class="container-fluid">
        <div class="row">
          <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
            <div class="sidebar-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item">
                      <a class="nav-link active" href="#">
                        <span data-feather="home"></span>
                        Dashboard <span class="sr-only">(current)</span>
                      </a>
                    </li>

                    {% for sensor in sensors %}
                    <li class="nav-item">
                      <a class="nav-link" href="./{{ sensor.id }}">
                        <span data-feather="bar-chart-2"></span>
                        {{ sensor.ShortName }}
                      </a>
                    </li>
                    {% endfor %}

            </div>
          </nav>

          <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
              <h1 class="h2">{% if not current_sensor %}Dashboard {% else %}Sensor id: {{current_sensor}}{% endif %}</h1>
              <div class="btn-toolbar mb-2 mb-md-0">
                <div class="btn-group mr-2">
                  <button type="button" class="btn btn-sm btn-outline-secondary">Share</button>
                  <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
                </div>
                <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
                  <span data-feather="calendar"></span>
                  This week
                </button>
              </div>
            </div>
            <div id="chartBargraph" style="height: 600px;width:600px;"></div>
          </main>
        </div>
      </div>

    </body>

<script>

  var barGraphData ={};

  d3.json("/sensor/{{ current_sensor }}/data", function(data) {
      data.forEach(function(d) {
          d.Date =  d3.isoParse(d.Date);
          barGraphData[d.Date]=d.Value
    });
 
  console.log(barGraphData)

  var width = 1600,
  scaleFactor = 10,
  barHeight = 20;

  var graph = d3.select("#chartBargraph")
            .append("svg")
            .attr("width", width)
            .attr("height", barHeight * Object.keys(barGraphData).length);


            var bar = graph.selectAll("g")
                  .data(data)
                  .enter()
                  .append("g")
                  .attr("transform", function(d, i) {
                        return "translate(0," + i * barHeight + ")";
                  });

    bar.append("rect")
       .attr("width", function(d) {
                return d.Value * scaleFactor;
       })
       .attr("height", barHeight - 1);

    bar.append("text")
       .attr("x", function(d) { return (Object.keys(barGraphData).length*scaleFactor); })
       .attr("y", barHeight / 2)
       .attr("dy", ".35em")
       .text(function(d) { return d.Date; });

})
 
</script>


</html>